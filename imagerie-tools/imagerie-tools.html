<!-- fanuc registry definition -->
<script type="text/x-red" data-template-name="imagerie-settings">
    <div class="form-row">
        <label for="node-config-input-host"><i class="fa fa-link" aria-hidden="true"></i> Hostname</label>
        <input type="text" id="node-config-input-host" placeholder="host">
    </div>
</script>

<script type="text/x-red" data-help-name="imagerie-settings">
    <p>Imagerie Server Hostname</p>
</script>

<!-- getter -->
<script type="text/x-red" data-template-name="predict-upload">
    <div class="form-row">
        <label for="node-input-imagerieconfig"><i class="fa fa-link" aria-hidden="true"></i>Host:Port</label>
        <select id="node-input-imagerieconfig" ></select>
    </div>
    <div class="form-row">
        <label for="node-input-project"><i class="fa fa-outdent" aria-hidden="true"></i>Project</label>
        <select type="text" id="node-input-project" ></select>
    </div>
</script>

<script type="text/x-red" data-help-name="predict-upload">
    <p>finds trained objects from uploaded</p>
</script>

<!-- setter -->
<script type="text/x-red" data-template-name="predict-camera">
    <div class="form-row">
        <label for="node-input-imagerieconfig"><i class="fa fa-link" aria-hidden="true"></i> Host:Port</label>
        <select id="node-input-imagerieconfig" ></select>
    </div>
    <div class="form-row">
        <label for="node-input-project"><i class="fa fa-registered" aria-hidden="true"></i> Project</label>
        <select type="text" id="node-input-project" ></select>
    </div>
    <div class="form-row">
        <label for="node-input-camera"><i class="fa fa-registered" aria-hidden="true"></i> Camera</label>
        <select type="text" id="node-input-camera" ></select>
    </div>
</script>

<script type="text/x-red" data-help-name="predict-camera">
    <p>finds trained objects from selected camera stream</p>
</script>


<script type="text/javascript">
(function() {
    RED.nodes.registerType('imagerie-settings',{
        category: 'config',
        defaults: {
            host: {value:"http://35.232.117.223:80",required:true},
        },
        inputs:0,
        outputs:0,
        label: function() {
            return this.host;
        },
        oneditprepare: function() {
           var node = this;
           console.log("ONEDITPREPARE", node);

           var host = RED.nodes.getNode(node);
           console.log("HOST CONFIG: ",  host);

          $.getJSON(host + '/project', function(data) {
            console.log("KNOWN PROJECTS", data);
          });
          // AJAX query projects from this server!!
          $('#node-input-project').change(function() {
              console.log($(this).val())
          });
        }
    });

    RED.nodes.registerType('predict-upload',{
        category: 'FlexibleAssembly',
        color: '#8eed28',
        defaults: {
            project: {value:"",required:true},
            imagerieconfig: {type:"imagerie-settings",required:true, value:"http://35.232.117.223:80"}
        },
        inputs:1,
        outputs:1,
        icon: "Robot_Receive2.png",
        label: function() {
          return this.name || "predict " + this.project;
        },
        oneditprepare: function(e) {
          var node = this;
          console.log("ONEDITPREPARE", node, e);

          var host = RED.nodes.getNode(node);
          console.log("HOST: ", host);

          $.getJSON(host + '/project', function(data) {
            console.log("KNOWN PROJECTS", data);
          });

          // AJAX query projects from this server!!
          $('#node-input-project').change(function() {
              console.log($(this).val())
          });
        }
    });

    RED.nodes.registerType('predict-camera',{
        category: 'FlexibleAssembly',
        color: '#33d4f4',
        defaults: {
            project: {value:"",required:true},
            camera: {value:"",required:true},
            imagerieconfig: {type:"imagerie-settings",required:true, value:"http://35.232.117.223:80"},
        },
        inputs:1,
        outputs:1,
        icon: "Robot_Send2.png",
        label: function() {
          return this.name || "predict " + this.project + ":" + this.camera;
        },
        oneditprepare: function() {
           var node = this;
           console.log("ONEDITPREPARE", node);

           var host = RED.nodes.getNode(node.imagerieconfig);
           console.log("HOST: ", host);

          $.getJSON(host + '/project', function(data) {
            console.log("KNOWN PROJECTS", data);
          });
          // AJAX query projects from this server!!
          $('#node-input-project').change(function() {
              console.log($(this).val())
          });
        }
    });
})();
</script>
