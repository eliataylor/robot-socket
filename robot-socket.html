<script type="text/x-red" data-template-name="robot-socket">
    <div class="form-row">
        <label for="node-input-name"><i class="icon-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-row">
        <label for="node-input-host"><i class="icon-tag"></i> Hostname / IP Address:Port</label>
        <input type="text" id="node-input-host" placeholder="host">
    </div>
    <div class="form-row">
        <label for="node-input-regpoint"><i class="icon-tag"></i>Registry</label>
        <select id="node-input-regpoint" ></select>
    </div>
    <div id="node-input-simulated-block" class="form-row">
        <label for="node-input-simulated"><i class="icon-tag"></i>Simulated</label>
        <select id="node-input-simulated" >
          <option value="1">simulated</option>
          <option value="0">not simulated</option>
        </select>
    </div>
</script>

<script type="text/x-red" data-help-name="robot-socket">
    <p>simple configurable communication node between fanuc and node-red interface</p>
</script>

<script type="text/javascript">
    RED.nodes.registerType('robot-socket',{
        category: 'FlexibleAssembly',
        color: '#0467A9',
        defaults: {
            name: {value:""},
            host: {value:"127.0.0.1:1880",required:true},
            regpoint: {value:"",type:"fanuc-registry",required:true},
            simulated :{value:""}
        },
        inputs:1,
        outputs:1,
        icon: "fa.png",
        label: function() {
            return this.name || "robot-socket";
        },
        oneditsave: function() {
          /* TODO: just test editting didn't break connection
          var node = this;
          $.ajax('http://' + node.ip)
          .done(function(data){
          //  node.status({fill:"green",shape:"dot",text:"node-red:common.status.connected"});
          })
          .fail(function(){
            // node.status({fill:"red",shape:"dot",text:"node-red:common.status.not-connected"});
          });
          */
        }
    });
</script>


<!-- fanuc registry definition -->


<script type="text/x-red" data-template-name="fanuc-registry">
    <div class="form-row">
        <label for="node-config-input-reg"><i class="icon-tag"></i>Reg Property</label>
        <select type="text" id="node-config-input-reg" >
            <option value="numreg">numreg</option>
            <option value="strreg">strreg</option>
            <option data-val="1" value="DIN">DIN (digital input)</option>
            <option data-val="2" value="DOUT">DOUT (digital output)</option>
            <option data-val="8" value="RI">RO (robot input)</option>
            <option data-val="9" value="RO">RO (robot output)</option>
            <option data-val="35" value="RO">Flag</option>
            <option value="ALARM">ALARM</option>
        </select>
    </div>
    <div class="form-row">
        <label for="node-config-input-index"><i class="icon-tag"></i> Reg Index</label>
        <input type="text" id="node-config-input-index" placeholder="index">
    </div>
</script>

<script type="text/x-red" data-help-name="fanuc-registry">
    <p>Fanuc Registry / Index configuration options</p>
</script>


<script type="text/javascript">
    RED.nodes.registerType('fanuc-registry',{
        category: 'config',
        defaults: {
            reg: {value:"",required:true},
            index: {value:"",required:true,validate:RED.validators.number()}
        },
        label: function() {
            this.reg = this.reg || '';
            this.index = this.index || 0;
            return this.reg + ':' + this.index;
        },
        oneditprepare: function() {
            $('#node-config-input-reg').change(function() {
                var id = $( "#node-config-input-reg" ).val();
                if (id == 'ALARM') {
                  $('#node-input-simulated-block').show();
                } else {
                  $('#node-input-simulated-block').hide();
                }
            });
        }
    });
</script>
